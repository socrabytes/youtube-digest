name: Issue Management
on:
  issues:
    types: [labeled, opened, assigned]
  create:
    types: [branch]

jobs:
  sort_issues:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'bug')
    steps:
      - name: Move Bugs to Bug Column
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh issue edit ${{ github.event.issue.number }} \
            --project "Youtube Video Digest" \
            --project-column "Bugs"

  handle_assignment:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' && github.event.action == 'assigned'
    steps:
      - name: Move to Todo when Assigned
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh issue edit ${{ github.event.issue.number }} \
            --project "Youtube Video Digest" \
            --project-column "Todo"

  track_progress:
    runs-on: ubuntu-latest
    if: github.event_name == 'create' && github.event.ref_type == 'branch'
    steps:
      - name: Move Issue to In Progress
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: ${{ github.event.ref }}
        run: |
          # Extract issue number from branch name (e.g., feat/42-add-feature -> 42)
          ISSUE_NUM=$(echo $BRANCH | grep -o '[0-9]\+' || echo '')
          
          if [ ! -z "$ISSUE_NUM" ]; then
            gh issue edit $ISSUE_NUM \
              --project "Youtube Video Digest" \
              --project-column "In Progress"
          fi
